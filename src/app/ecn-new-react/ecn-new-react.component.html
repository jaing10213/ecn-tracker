<div class="container-fluid">
  <br>
  <!--  <div *ngIf="blnEcnSaved" class="alert alert-success" role="alert">
    <p> The ECN has been successfully saved to the database </p>
  </div>-->
  <div class="card">

    <div class="card-header">
      <div class="row">
        <div class="col-sm-4">
          <span class="text-info"><h2> {{pageTitle}} </h2> </span>
        </div>
        <div class="col-sm-4" >
           <i *ngIf="!blnEcnLoaded" class="fa fa-spinner  fa-pulse "></i>
        </div>
      </div>



    </div>

    <div class="card-body " >

      <div>

        <form [formGroup]='newEcnForm'>

          <!--ECN No-->
          <div class="row form-group">
            <label class=" col-sm-2 col-form-label text-right" for="ecnNoId">No.: </label>
            <div class="col-sm-4 ">
              <input class="form-control form-control-lg" 
              [ngClass]="{'is-invalid': ecnErrorMessage, 'is-valid' : isEcnValid }"
                type="text" placeholder="Required (min. 7 characters)" id="ecnNoId"
                formControlName="ecnNo">
              <div class="form-text invalid-feedback" *ngFor='let error of ecnErrorMessage'>
                 <i class="fa fa-exclamation-circle" aria-hidden="true"> {{error}}</i> 
              </div>
            </div>
          </div>

          <!--Title-->
          <div class="row form-group">
            <label class=" col-sm-2 col-form-label text-right" for="titleId">Title: </label>
            <div class="col-sm-4 " >
              <input class="form-control form-control-lg" 
              [ngClass]="{'is-invalid':(newEcnForm.get('title').touched || newEcnForm.get('title').dirty) && !newEcnForm.get('title').valid, 'is-valid': (newEcnForm.get('title').valid && newEcnForm.get('title').dirty )}"
              type="text" placeholder="Required" id="titleId" formControlName="title">
              <div class="form-text invalid-feedback">
                <i class="fa fa-exclamation-circle" aria-hidden="true"></i> Please enter a valid Title
              </div>
            </div>
          </div>
          <!--Priority-->
          <div class="row form-group">
            <label class=" col-sm-2 col-form-label text-right" for="priorityId">Priority: </label>
            <div class="col-sm-4 " >
              <input class="form-control form-control-lg" 
              [ngClass]="{'is-invalid':priorityErrorMessage, 'is-valid': isPriorityValid}"
              type="number" min="1" placeholder="1-10" id="priorityId"
                formControlName="priority">
              <div class="form-text invalid-feedback" *ngFor='let error of priorityErrorMessage'>
                 <i class="fa fa-exclamation-circle" aria-hidden="true"> {{error}}</i> 
              </div>
            </div>
          </div>

          <!--ECN Originator-->
          <div class="row form-group">
            <label class=" col-sm-2 col-form-label text-right" for="dropdownMenuButton">Originator: </label>
            <div class="dropdown col-sm-4 ">

              <select class="form-control form-control-lg" formControlName="originatorId">
                    <option *ngFor='let user of userList'  [value]=user.Key>
                      {{user.Value}}
                    </option>
                  </select>

            </div>
          </div>

          <!--Current Worker-->
          <div class="row form-group">
            <label class=" col-sm-2 col-form-label text-right" for="dropdownMenuButton">Resource: </label>
            <div class="dropdown col-sm-4 ">

              <select class="form-control form-control-lg" formControlName="currentWorkerId">
                    <option ></option>
                    <option *ngFor='let user of userList' [value]=user.Key>
                       {{user.Value}}
                    </option>
                  </select>

            </div>
          </div>

          <!--Project-->
          <div class="row form-group">
            <label class=" col-sm-2 col-form-label text-right" for="dropdownMenuButton">Project: </label>
            <div class="dropdown col-sm-4 ">

              <select class="form-control form-control-lg" formControlName="projectId">
                  <option *ngFor='let project of projectList'  [value]=project.Key>
                  {{project.Value}}
                  </option>
                </select>

            </div>
          </div>

          <!--Status-->
          <div class="row form-group">
            <label class=" col-sm-2 col-form-label text-right" for="statusId">Status: </label>
            <div class="col-sm-4 " >
              <input class="form-control form-control-lg"
              [ngClass]="{'is-invalid':(newEcnForm.get('status').touched || newEcnForm.get('status').dirty) && !newEcnForm.get('status').valid, 'is-valid': (newEcnForm.get('status').valid && newEcnForm.get('status').dirty )}"
               type="text" placeholder="Required (min. 3 characters)" id="statusId"
                formControlName="status">

                  <!--Make sure error property is not null before accessing it-->
                  <div class="form-text invalid-feedback" *ngIf="newEcnForm.get('status').errors?.required">
                    <i class="fa fa-exclamation-circle"   aria-hidden="true"></i> Please enter a valid status
                  </div>
                  <div class="form-text invalid-feedback" *ngIf="newEcnForm.get('status').errors?.minlength" >
                    <i class="fa fa-exclamation-circle"  aria-hidden="true"></i> Status should be a minimum of 3 characters
                  </div>
               
              
            </div>
          </div>

          <!--Status Date-->
          <div class="row form-group">
            <label class=" col-sm-2 col-form-label text-right" for="statusDateId">Status Date: </label>
            <div class="col-sm-4 " >
              <input class="form-control form-control-lg" 
              [ngClass]="{'is-invalid':(newEcnForm.get('statusDate').touched || newEcnForm.get('statusDate').dirty) && !newEcnForm.get('statusDate').valid, 'is-valid': (newEcnForm.get('statusDate').valid && newEcnForm.get('statusDate').dirty )}"
              type="text" placeholder="Required" id="statusDateId" formControlName="statusDate"> 
            <div class="form-text invalid-feedback">
                <i class="fa fa-exclamation-circle"   aria-hidden="true"></i> Please enter a valid status date
            </div>
            </div>
          </div>

          <!--Description-->
          <div class="row form-group">
            <label class=" col-sm-2 col-form-label text-right" for="descriptionId">Description: </label>
            <div class="col-sm-4 ">

              <textarea class="form-control form-control-lg" rows="4" id="descriptionId" formControlName="description"> </textarea>

            </div>
            <div class="col-sm-6 col-form-label">
              <small class="form-text text-muted text-danger" *ngIf="newEcnForm.get('description').touched && newEcnForm.get('description').errors"> Please enter a valid description</small>
            </div>
          </div>

          <!--Tags-->
          <div class="row form-group">
            <label class=" col-sm-2 col-form-label text-right" for="tagsId">Tags: </label>
            <div class="col-sm-4 ">

              <input type="text" class="form-control form-control-lg" id="tagsId" formControlName="tags" placeholder="comma separated">

            </div>
            <div class="col-sm-6 col-form-label">
              <small class="form-text text-muted text-danger" *ngIf="newEcnForm.get('tags').touched && newEcnForm.get('tags').errors"> Please enter valid tags</small>
            </div>
          </div>

        </form>
      </div>
    </div>



    <div class="card-footer">
      <div class="row">
        <div>
          <input type="button" class="btn btn-outline-primary " value="Save" (click)="saveEcn()" [disabled]='!newEcnForm.valid'>

          <input type="button" class="btn btn-outline-primary" value="Back" [routerLink]="['/',uId,pId,'ecns']"/>

          <span style="font-size:100%">
            <span *ngIf="blnEcnSaving">
              <i class="fa fa-spinner  fa-pulse "></i>
            </span>
            <span *ngIf="blnEcnSaved">
              <i class="fa fa-check" style="color:green;"> Ecn Saved</i>
            </span>
          </span>
        </div>
      


      </div>
    </div>

  </div>

</div>

<!--<br> formValue = {{newEcnForm.value | json}}-->
<!--<br>
{{ecnErrorMessage}}-->
