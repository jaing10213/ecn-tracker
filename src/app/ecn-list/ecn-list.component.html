<div class="container-fluid">




  <i class="fa fa-plus-square-o" role="button" style="font-size:75%;" data-toggle="modal" data-target="#filterModal"></i>

  <div id="filterModal" class="modal fade" tabindex="-1" role="dialog">
    <div class="modal-dialog modal-lg">
      <!-- Modal content-->
      <div class="modal-content">
        
        <table class="table rounded " style="font-size: 55%;">
          <thead class="thead-default text-center">
            <tr>
              <th>Projects</th>
              <th>Status</th>
              <th>Resource</th>
              <th>Priority</th>
              <th>Tags</th>
            </tr>

          </thead>
          <tbody>
            <tr>
              <td></td>
              <td>
                <span *ngFor='let status of statusList'>
                  <div class=" form-check">
                    <label class="form-check-label m-2">
                      <input class="form-check-input"  type="checkbox" [(ngModel)] = 'status.checked'
                      value={{status.value}} name={{status.checked}}
                      (change) = "filterOnStatus()" >  
                      {{status.value}}   
                    </label>
                  </div>
                </span>
              </td>
              <td>
                <span *ngFor='let resource of resourceList'>
                <div class=" form-check">
                  <label class="form-check-label m-2">
                    <input class="form-check-input" type="checkbox" [(ngModel)] = 'resource.checked'
                    value={{resource.value}} name={{resource.checked}}
                    (change) = "filterOnResources()">
                    {{resource.value}}
                  </label>
                </div>
              </span>

              </td>

              <td>
                <span *ngFor='let priority of priorityList'>
                <div class=" form-check">
                <label class="form-check-label m-2" >
                    <input class="form-check-input" type="checkbox" [(ngModel)] = 'priority.checked'
                    value={{priority.value}} name={{priority.checked}}
                    (change) = "filterOnPriority()">
                    {{priority.value}}
                  </label>
              </div>
                </span>
              </td>

              <td>
                <span *ngFor='let tag of tagsList'>
                <div class=" form-check">
                <label class="form-check-label m-2" >
                    <input class="form-check-input" type="checkbox" [(ngModel)] = 'tag.checked'
                    value={{tag.value}} name={{tag.checked}}
                    (change) = "filterOnTags()">
                    {{tag.value}}
                  </label>
              </div>
                </span>
              </td>
            </tr>

          </tbody>

        </table>

    

      </div>
    </div>
  </div>
  <ngb-tabset>


    <ngb-tab title="ECN">
      <template ngbTabContent>
        <div class='card'>
          <div class="card-header">
            <div class="row">
              <div class="col-sm-4">
                <div *ngIf="ecns && ecns?.length" class="form-group row" style="font-size: 55%;">
                  <label class="col-form-label col-sm-2  text-right" for="txtSearch">Search</label>
                  <input class="form-control col-sm-10 " name="txtSearch" type="text" [(ngModel)]="serText">
                </div>
              </div>
              <div class="col-sm-4">
                              <sk-wave *ngIf="!ecnsLoaded"></sk-wave>   
              </div>
              <div class="col-sm-4 text-right">
                <button class="btn btn-info btn-md" value="New ECN" [routerLink]="['/ecns/0']">New ECN</button>
              </div>
            </div>
          </div>

          <div class="card-block p-0">

            

            <div class="table-responsive table-hover">

              <table class="table rounded" *ngIf='ecns && ecns?.length' style="font-size: 55%;">

                <thead class="thead-primary">
                  <tr>
                    <th>#</th>
                    <th><a role="button" (click)="sortColumn('ecnNo')">ECN No</a></th>
                    <th>Title</th>
                    <th><a role="button" (click)="sortColumn('status')">Status <i class="fa fa-arrow-down" aria-hidden="true" [hidden]="!sortAsc"></i><i class="fa fa-arrow-up" aria-hidden="true" [hidden]="sortAsc"></i> </a></th>
                    <th><a role="button" (click)="sortColumn('priority')">Priority</a></th>
                    <th><a role="button" (click)="sortColumn('resource')">Current Resource</a></th>
                    <th>Comments</th>

                    <th></th>
                  </tr>
                  <tr>

                </thead>
                <tbody>
                  <tr *ngFor='let ecn of ecns.slice().reverse() | ecnFilter:serText | ecnResource:filterOnResources()|ecnStatus:filterOnStatus() | ecnPriority:filterOnPriority()|ecnTags:filterOnTags(); let i = index;'> 
                    <td>{{i+1}}</td>
                    <td><a style="font-size: 110%;" role="button" [routerLink]="['/ecns', ecn.id]">{{ecn.ecnNo}}</a> </td>
                    <td>{{ecn.title}}</td>
                    <td>
                      <span>{{ecn.status}}</span>
                      <span class="badge badge-primary">{{calcDays(ecn.statusDate)}}</span>
                      <div style="font-size:75%;"> <span> {{ecn.statusDate|date}} </span> </div>
                    </td>
                    <td>{{ecn.priority}}</td>
                    <td>{{ecn.currentWorkerName}}</td>
                    <td style="font-size: 80%;">

                      <div *ngFor='let comment of ecn.comments | commentSorter | arrayLimiter:nComments'>

                        <label class="font-italic"><span class="text-warning"> {{comment.date|date}} </span>: <span > {{comment.value }} </span></label>

                      </div>

                      <i role="button" style="font-size: 150%; padding-right: 5px;" data-toggle="modal" data-target="#commentsModal" (click)='setCurrentComment(ecn.id)'
                        class="fa fa-list" aria-hidden="true"></i>
                      <i role="button" style="font-size: 150%; padding-left: 5px; " data-toggle="modal" data-target="#newCommentModal" (click)='setCurrentComment(ecn.id)'
                        class="fa fa-plus-square-o" aria-hidden="true"></i>
                    </td>

                    <td>

                      <i role="button" class="fa fa-trash" aria-hidden="true" style="font-size: 150%;" data-toggle="modal" data-target="#deleteModal"
                        (click)='setDeleteEcn(ecn.id)'></i>

                      <!-- Modal -->
                      <div id="deleteModal" class="modal modal" role="dialog">
                        <div class="modal-dialog">
                          <!-- Modal content-->
                          <div class="modal-content">
                            <!--Modal Header-->
                            <div class="modal-header">
                              <h4 class="modal-title">Do you really want to delete this ECN? </h4>
                            </div>

                            <div class="modal-footer">
                              <div class="button-group">

                                <button type="button" class="btn btn-danger" data-dismiss="modal" (click)="deleteEcn()">Ok</button>
                                <button type="button" class="btn btn-info" data-dismiss="modal">Cancel</button>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>

                    </td>

                  </tr>
                </tbody>
              </table>
            </div>

          </div>
        </div>

        <div id="commentsModal" class="modal modal-fade" role="dialog">
          <div class="modal-dialog modal-lg" *ngIf="currComment">
            <!-- Modal content-->
            <ecn-comment [inpType]='commentInpType' (notifyDelete) = "commentDeleted($event)" [comments]='currComment|commentSorter'></ecn-comment>
          </div>
        </div>

      </template>
    </ngb-tab>

    <ngb-tab title="SUMMARY">
      <template ngbTabContent>
        <br>
        <div class="row">
          <div class="card-deck col-sm-12">
            <div class="card">
              <div class="card-header card-inverse card-warning text-center">
                Status Summary
              </div>
              <div class="card-block">
                <table class="table " style="font-size:65%;">

                  <tbody>
                    <tr *ngFor="let item of ecns|ecnResource:filterOnResources()|ecnTags:filterOnTags()|ecnSummary:'status'">
                      <td>{{item.prop}}</td>
                      <td>{{item.count}}</td>
                    </tr>
                  </tbody>
                  <tfoot>
                    <tr class="font-weight-bold">
                      <td>Total</td>
                      <td> {{ecns|ecnResource:filterOnResources()|ecnTags:filterOnTags()|ecnSummary:'status'|arrayTotal:'count'
                        }}
                      </td>
                    </tr>
                  </tfoot>
                </table>
              </div>
            </div>

            <div class="card">
              <div class="card-header card-inverse card-warning text-center">
                Resource Summary
              </div>
              <div class="card-block">
                <table class="table" style="font-size:65%;">

                  <tbody>
                    <tr *ngFor="let item of ecns|ecnStatus:filterOnStatus()|ecnTags:filterOnTags()|ecnSummary:'currentWorkerName'">
                      <td>{{item.prop}}</td>
                      <td>{{item.count}}</td>
                    </tr>
                  </tbody>
                  <tfoot>
                    <tr class="font-weight-bold">
                      <td>Total</td>
                      <td> {{ecns|ecnStatus:filterOnStatus()|ecnTags:filterOnTags()|ecnSummary:'currentWorkerName'|arrayTotal:'count'
                        }}
                      </td>
                    </tr>
                  </tfoot>
                </table>
              </div>
            </div>
          </div>
        </div>
      </template>
    </ngb-tab>


  </ngb-tabset>
  <br>

  <div id="newCommentModal" class="modal modal" role="dialog">
    <div class="modal-dialog modal-lg">
      <!-- Modal content-->
      <new-comment (notify)='newCommentCreated($event)' [ecnId]='currEcnId'></new-comment>

    </div>
  </div>
